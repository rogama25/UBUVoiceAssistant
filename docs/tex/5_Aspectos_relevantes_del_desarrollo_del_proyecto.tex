\capitulo{5}{Aspectos relevantes del desarrollo del proyecto}

En este apartado se recogen los aspectos más importantes del desarrollo del proyecto, como los problemas que han ido surgiendo y las diferentes decisiones que se han ido tomando.

\section{Uso de contenedores Docker}
En un primer momento se consideró la posibilidad de usar contenedores Docker tanto para la distribución de Mycroft como para la interfaz gráfica para facilitar el proceso de instalación.
Mycroft ofrece un contenedor ya creado con su aplicación, junto a las instrucciones de uso. Al instalarlo y ejecutarlo durante las primeras semanas del proyecto, todo funcionaba correctamente. Sin embargo, al probar a realizar la instalación en otra máquina, el contenedor no captaba sonido del micrófono y en ocasiones fallaba al reproducir las respuestas de Mycroft. Al reinstalar el contenedor de Mycroft en la máquina en la que anteriormente funcionaba correctamente, también dejó de captar el sonido y no vi manera de solucionarlo. Por esto, se optó por usar la aplicación nativa de Mycroft para Linux.
Con respecto a la interfaz gráfica, al ser más complicado lanzar de manera automatizada Mycroft, ubicado en el equipo host, desde un contenedor en el que se ubicase la interfaz, se desestimó completamente el uso de Docker.

\section{Creación del instalador}
Debido a la compleja instalación que había en la versión anterior del proyecto, y al no poder usar contenedores ya listos, se opta por crear un instalador que automatice la obtención e instalación de las dependencias, la copia de los archivos a las ubicaciones adecuadas y la creación de accesos directos a la aplicación. Para realizarlo se opta por crear un \textit{script} de línea de comandos para la primera versión, eligiendo Bash debido a que se usa habitualmente para esta finalidad y a que está disponible en la gran mayoría de sistemas. Debido a la diferente arquitectura y popularidad de las diferentes distribuciones Linux, se opta por Ubuntu como la principal distribución a soportar, aunque el funcionamiento será también correcto en otras que derivan de ella.

\section{Mejoras de la interfaz}
En la versión anterior del proyecto se creó una interfaz gráfica, pero los archivos que permitían editarla mediante QtDesigner no se subieron al repositorio. Al ser conveniente realizar algunas mejoras de estabilidad y de diseño, se opta por crear una segunda versión de la interfaz desde cero, pero manteniendo un diseño lo más simple posible. En la nueva interfaz se consigue que sea más estable que la anterior, evitando algunos de los cuelgues que antes se producían en algunas partes de la ejecución. También se crea un nuevo apartado de la interfaz que te guía en el proceso del emparejamiento con los servicios de Mycroft, paso necesario para poder usar el reconocimiento de voz. Finalmente, se opta por hacer un rediseño de la interfaz de chat, pasando de usar en algunos apartados los \textit{widgets} nativos que ofrece Qt a usar HTML embebido que ofrece mayor flexibilidad a la hora de crear los bocadillos de conversación.

\section{Localización}
Anteriormente se podía seleccionar entre inglés o español como idioma para usar la aplicación, que estaban incluidos en el código fuente de la aplicación. Debido a que esto es una mala práctica, se opta por usar una biblioteca de localización que cargue cada uno de los textos a mostrar desde archivos externos al código, lo que también hace más fácil añadir nuevos idiomas posteriormente sin tener que modificar nada de código. Se elige \textit{gettext} como biblioteca a usar debido a la existencia de software como Poedit que hace sencilla la generación de nuevos archivos de idioma.

\section{Uso de contexto}
También se busca mejorar la interacción con el asistente, y se considera empezar a trabajar con el contexto para que el asistente recuerde algunos elementos a lo largo de la conversación. En las anteriores skills que se habían realizado para el proyecto, se había usado Padatious como intent parser pero al revisar la documentación, todavía no es posible usar el contexto. Al ver este problema, se opta por realizar una nueva skill usando Adapt.
Si bien es cierto que ambos \textit{intent parsers} permiten acceden a un gran número de funciones comunes proporcionadas por Mycroft, la manera de crear \textit{skills} es completamente diferente. Destacar que es más complicado crearlas usando Adapt debido a que la documentación es considerablemente más escasa y que es imprescindible usar expresiones regulares para definir cada uno de los \textit{intents}, donde además hay que indicar también los posibles signos de puntuación.

\section{Instalación en Windows}
Previamente, uno de los principales puntos débiles de este proyecto era la necesidad de tener un sistema operativo Linux para poder usar el asistente. Sin embargo, en las últimas versiones de Windows 10 se ha incorporado una funcionalidad (Windows Subsystem for Linux, o WSL) con la que se puede ejecutar una versión ligera de Linux dentro de ese sistema operativo, pudiendo ejecutar nuestra aplicación sin necesidad de instalar una máquina virtual completa. Por el momento, es necesario instalar en Windows un servidor X11 para mostrar interfaces gráficas y Pulseaudio para grabar y reproducir sonido, pero Microsoft está trabajando para que en versiones futuras del sistema, esto ya venga incluido.